# 概述
- 特点：
	- 电路结构上：包含存储电路和组合电路；存储器状态和输入变量共同决定输出
	- 功能上：任一时刻的输出不仅取决于该时刻的输入，还与电路原来的状态有关
- 一般结构形式与功能描述：
	- 结构：![[Pasted image 20241111095828.png]]
	- 描述：三组方程
		- ![[Pasted image 20241111100003.png]]
- 分类：
	1. 同步时序电路与异步时序电路：
		- 同步：存储电路中所有触发器的时钟使用统一的clk，状态变化发生在同一时刻
		- 异步：没有统一的clk，触发器状态的变化有先有后
	2. Mealy型和Moore型
		- Mealy型：$Y=F(X,Q)$，输出与输入和状态有关
		- Moore型： $Y=F(Q)$，输出仅取决于电路状态，即输出受输入的影响有一个延迟
# 时序电路的分析方法
- 同步时序电路的分析方法：
	1. 找出在输入和 CLK 作用下，电路的次态和输出，列方程组
		1. 从给定电路写出存储电路中每个触发器输入端的逻辑式，得到整个电路的驱动方程
		2. 将驱动方程代入触发器的特性方程，得到状态方程
		3. 从给定电路直接写出输出方程
		- 例：![[Pasted image 20241111101244.png]]
	2. 画出状态转换表、状态转换图和时序图
		1. 状态转换表：![[Pasted image 20241111101417.png]]
		2. 状态转换图：![[Pasted image 20241111101504.png]]说明：箭头上，斜杠左侧表示输入，右侧表示输出，圆圈内左到右依次表示状态的高位到低位
		3. 时序图：条件：![[Pasted image 20241111101722.png]]
- 异步时序逻辑电路的分析方法：画波形图
	- 例：![[Pasted image 20241111102722.png]]![[Pasted image 20241111102733.png]]
# 中规模的时序电路
- 移位寄存器 Shift Register：
	- 具有存储、移位功能
	- 结构：![[Pasted image 20241111103218.png]]
	- CLK上升沿到达时，个触发器按照前一级触发器的状态翻转，数据依次右移一位![[Pasted image 20241111103502.png]]
	- 器件实例：74LS194A ，可以实现左/右移、并行输入、保持、异步置零![[Pasted image 20241111104238.png]]
		- 分析：四个触发器实现移位寄存的结构，与或非的结构实现的是四选一的MUX，用于在左/右移，并行输入，保持间切换，$R_D'$为异步置零初始化端
		- ![[Pasted image 20241111104818.png]]注：左右移与二进制数的左右移相反
		- 扩展：利用左移输入与右移输入端扩展![[Pasted image 20241111105112.png]]
		- 应用：代码的串并行转换/数据运算，可以用它实现一个串行进位加法器![[Pasted image 20241111105417.png]]
			- 初始时，输入寄存器置为并行输入模式，让输入全部加载到输出，从低位开始相加
			- 输出结果过接入右移输入端，输出寄存器接到右移模式，从低位逐步输出结果
			- 之后，输入应该置为左移模式，将高位逐步移到最低位处相加
			- 最后一个时刻的输出，即为所需要的结果
- 计数器 Counter：
	- 用于计数、分频、定时、产生顺序脉冲和序列信号
	- 分类：
		- 按时钟分：同步、异步
		- 按计数过程中数字增减分：加、减和可逆
		- 按计数器中的数字编码分：二进制、二-十进制和格雷码……
		- 按计数容量分：十进制、六十进制……
	- 同步计数器：
		1. 同步二进制计数器：
			1. 同步二进制加法计数器：
				- 原理：根据二进制加法运算规则可知，在多位二进制数末位加1，若第i位以下皆为1时，则第i位应翻转
				- 逻辑式：$T_0\equiv1,T_i=Q_{i-1}Q_{i-2}...Q_0$
				- 状态图与时序图：![[Pasted image 20241111112149.png]]![[Pasted image 20241111112152.png]]分频器：可以将高频率的clk降低到低频率
				- 器件实例： 74161，可以实现加法计数、保持、预置数和置零
					- 结构：![[Pasted image 20241111112114.png]]![[Pasted image 20241111111634.png]]说明：利用不同级别的与非门、或门，实现了对控制输入功能端的分级输入：$R_D'>LD'>EP、ET$
					- 功能表：![[Pasted image 20241111112111.png]]
				- 应用实例：
					- 顺序脉冲发生器：计数器+译码器![[Pasted image 20241113154736.png]]![[Pasted image 20241113154740.png]]
					- 序列信号发生器：计数器+数据选择器![[Pasted image 20241113154847.png]]发生序列性的周期信号
			2. 同步二进制减法计数器：
				- 原理：根据二进制减法运算规则可知，在多位二进制数末位减1，若第i位以下皆为0时，则第i位应翻转
				- 逻辑式：$T_0\equiv1,T_i=Q_{i-1}'Q_{i-2}'...Q_0'$
				- 结构：![[Pasted image 20241113155459.png]]
			3. 同步二进制加减计数器：分单时钟实现方式和双时钟实现方式
				- 单时钟方式：加/减脉冲用同一输入端，由加/减信号控制加/减计数
					- 逻辑式：![[Pasted image 20241113155150.png]]
					- 结构：74191![[Pasted image 20241113155213.png]]
					- 功能表：![[Pasted image 20241113155221.png]]预置数不受CLK影响，立刻发生；C/B为进位/借位输出端，$CLK_0$为串行时钟输出端，当进位/借位输出端为1时，在CLK下降沿会输出负脉冲，到上升沿停止
					- 波形图：![[Pasted image 20241113161114.png]]
				- 双时钟方式：加/减脉冲分别用一个输入端，无加/减控制信号
					- 逻辑式：![[Pasted image 20241114162436.png]]u信号给出加法计数，d信号为减法，两者应当错开
					- 结构：![[Pasted image 20241114162520.png]]
					- 波形实例：![[Pasted image 20241114162535.png]]![[Pasted image 20241114162545.png]]
		2. 同步十进制计数器
			1. 加法计数器：
				- 原理：扩展十六进制计数器，使得结果为1001时，回到0000
				- 逻辑修正：只需要修改$T_1$和$T_3$的逻辑式：$T_1=Q_0Q_3'$，$T_3=Q_2Q_1Q_0+Q_3Q_0$
				- 状态图：![[Pasted image 20241113162306.png]]即使初始状态不在十进制循环圈内，也可以自启动
				- 符号与结构：74160芯片，结构与74161很类似![[Pasted image 20241113162526.png]]
				- 功能表：完全相同![[Pasted image 20241113162537.png]]
			2. 减法计数器：
				- 同理修改逻辑式：$T_1=Q_0'(Q_3'Q_2'Q_1')'$，$T_3=Q_1'Q_0'·(Q_3'Q_2'Q_1')'$
				- 状态转换图：可以自启动![[Pasted image 20241113162850.png]]
			3. 可逆计数器：基本原理一致，也有单时钟和双时钟，分别为74190和74192
	- 异步计数器：
		1. 二进制计数器：
			1. 加法计数器：末位加1时，逐步向高位进位
				- 例：![[Pasted image 20241113163404.png]]![[Pasted image 20241113163408.png]]
			2. 减法计数器：末位减1时，逐位借位
				- 例： ![[Pasted image 20241113163639.png]]![[Pasted image 20241113163643.png]]
		2. 十进制加法计数器：![[Pasted image 20241113164248.png]]![[Pasted image 20241113164306.png]]
	- 任意进制计数器的构成：利用已有的计数器构造
		1. 缩减：计数循环中设法跳过N-M个状态
			- 置零法：利用置零端，在达到进位时置零
				- 例：![[Pasted image 20241113164722.png]]
				- 缺点：置零信号作用时间太短，有可能置零不完全，改进：加入一个锁存器的单元![[Pasted image 20241114163642.png]]S端信号进入，置1，消失后，由于状态不变，信号被维持，直到下一个脉冲才计数
			- 置数法：利用预置数功能进行状态跳过
				- 置入0000：![[Pasted image 20241114164117.png]]缺点：没有进位信号的输出
				- 置入1001：![[Pasted image 20241114164139.png]]置入十进制的最后一个数，产生进位输出
		2. 扩充：
			- 可分解：使用两个计数器级联
				- 例：百进制计数器
					- 并行进位：![[Pasted image 20241114164243.png]]用同一个 CLK，低位片的进位输出作为高位片的计数控制信号，两片始终同时接收 CLK 信号
					- 串行进位：![[Pasted image 20241114164317.png]]低位片的进位输出作为高位片的CLK，两片始终同时处于允许计数状态
			- 不可分解：先获得更大的计数器，在用缩减的方式改动
				- 例：![[Pasted image 20241114180706.png]]
# 时序逻辑电路的设计
- 设计方法：
	1. 逻辑抽象，得出状态转换图或状态转换表
		1. 确定输入/输出变量、电路状态
		2. 定义输入/输出逻辑含义以及每个电路状态的含义
		3. 按设计要求列出状态转换表，或画出状态转换图
	2. 状态化简：若两个状态在相同的输入下有相同的输出，并且转换到同一个次态，则称为等价状态。等价状态可以合并。
	3. 状态编码
		1. 确定触发器数目
		2. 给每个状态赋予一个代码
		3. 求出状态方程、输出方程
	4. 选定触发器类型：求出驱动方程
	5. 画出逻辑图
	6. 检查自启动
- 例：
	1. 设计一个密码锁，在连续输入三个或三个以上1时，输出为1锁打开
		1. 逻辑抽象，画状态转换图：![[Pasted image 20241118100313.png]]是Mealy型的时序电路（比较灵敏）
		2. 状态化简：2和3是等价的状态![[Pasted image 20241118100604.png]]
		3. 状态编码：作两位编码，求状态方程与输出方程（卡诺图）![[Pasted image 20241118100905.png]]
		4. 选用JK触发器，求驱动方程：变换成特性方程的形式![[Pasted image 20241118101037.png]]
		5. 检查自启动：从卡诺图就可以分析，圈内视为1，圈外视为0![[Pasted image 20241118101212.png]]
		6. 画电路图：![[Pasted image 20241118101404.png]]
		- 问题分析：输入信号和CLK信号的脉冲周期不一定匹配，需要对按键输入的信号做处理，使其宽度不超过CLK的一个周期
	2. 按键处理转换器：将按键按入的信号进行处理，使其缩减到一个脉冲周期
		1. 设计状态机：一个Moore型状态机如图![[Pasted image 20241118102407.png]]
		2. 转换逻辑式：![[Pasted image 20241118102907.png]]
		3. 基于D触发器的实现：![[Pasted image 20241118103053.png]]
		4. 基于移位寄存器的实现：前一拍0，后一拍1，即输出脉冲![[Pasted image 20241118103312.png]]
		5. 基于Mealy型时序电路的设计：![[Pasted image 20241118104110.png]]![[Pasted image 20241118104307.png]]
	3. 蚂蚁走迷宫：
		1. 抽象模型：![[Pasted image 20241118105022.png]]
		2. 设计状态：![[Pasted image 20241118105618.png]]![[Pasted image 20241118105623.png]]![[Pasted image 20241118105631.png]]![[Pasted image 20241118105636.png]]![[Pasted image 20241118105818.png]]合并等价状态：![[Pasted image 20241118110133.png]]
		3. 编码，抽象为逻辑函数并化简：![[Pasted image 20241118110200.png]]输出方程与状态方程：![[Pasted image 20241118110255.png]]
		4. 画电路图：![[Pasted image 20241118110324.png]]
		5. 基于存储器的实现：将结果全部存储在ROM中![[Pasted image 20241118110915.png]]
	4. 简单的计算机：计算n的阶乘
		1. 分析状态与数据通路：![[Pasted image 20241118111822.png]]划分成数个状态：![[Pasted image 20241118111856.png]]加入边界条件：![[Pasted image 20241118111925.png]]
		2. 缺点：有限状态机不能满足现代计算机的计算特点
# 时序逻辑电路的动态特性
- 对单个的寄存器，其有动态传输特性以及对应的参数：$t_{PD},t_{CD},t_{SETUP},t_{HOLD}$等等
- **两个时序不等式**：
	- **建立不等式**：$T>T_{pd,reg}+T_{pd,logic}+T_{setup}$，其中四项分别指CLK信号的周期，触发器的传输延迟，组合电路的传输延迟，触发器的建立时间![[Pasted image 20241120153034.png]]
	- **失效不等式**：$T_{cq,cd}+T_{logic,cd}>T_{hold}$，其中三项分别指触发器的失效延迟，组合电路的失效延迟，触发器的保持时间![[Pasted image 20241120153226.png]]
	- 例：
		- 阴影部分表示无效的状态，空白表示有效的状态![[Pasted image 20241120153639.png]]
		- ![[Pasted image 20241120154429.png]]对组合电路的直接输入，其建立时间为组合电路的生效延迟和触发器的建立时间之和$T_{pd,logic}+T_{setup,reg}$，保持时间为触发器保持时间和组合电路的失效延迟之差$T_{hold,reg}-T_{cd,logic}$
# 时序电路中的竞争冒险
- 存储电路的竞争-冒险现象：当输入信号和时钟信号同时改变，而且经过不同路径到达同一触发器时，便产生了竞争，竞争的结果有可能导致触发器误动作
- 同步时序电路中的竞争冒险：
	- 此处，如果两个时钟有时钟的差异，有可能发生竞争冒险![[Pasted image 20241120155835.png]]
	- 解决：设法在关键的地方增加一个延迟，例如增加门或者加入电容![[Pasted image 20241120155945.png]]![[Pasted image 20241120155948.png]]
- 异步时序电路的竞争冒险：
	- 异步八进制计数器：![[Pasted image 20241120160337.png]]竞争冒险如下：![[Pasted image 20241120160350.png]]此处，若$Q_2$到达晚，则会发生翻转，从101直接跳变到000，发生竞争冒险
## 基于FPGA的时序电路设计

- 阻塞式赋值和非阻塞式赋值：
	- “=”为阻塞式赋值，按串行逻辑进行
	- “<=”为非阻塞式赋值，按并行逻辑进行
	- 一般时序电路用非阻塞式赋值，组合电路一般用阻塞式赋值，二者在同一个always块中，不要混用；避免对同一个变量在不同块中进行赋值
- 例：
	- D触发器：
		- ![[Pasted image 20241120161922.png]]
		- ![[Pasted image 20241120161934.png]]
	- 移位寄存器：
		- ![[Pasted image 20241120162001.png]]
		- ![[Pasted image 20241120162006.png]]
	- 计数器74163：
		- ![[Pasted image 20241120162342.png]]
	- 有限状态机FSM：
		- “三段论”：
			1. 先写时序电路模块：控制状态方程
			2. 再写组合中的状态模块：实现状态方程
			3. 最后写输出：实现输出方程