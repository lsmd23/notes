# 分支-合并并行算法
- 要点：
	- 派生：允许程序在允许时进行“fork”，也即在运行时创建并行的子程序
	- 并行循环：允许循环并行执行
- 并行算法的关键要素：
	- 并行算法的运行时间：记$T_n$为$n$个并行线程下算法的时间，则有：
		- $T_p\leq \frac{T_1}{P}$
		- $T_p\geq T_\infty$
		- 算法的加速比为$\frac{T_1}{T_p}$，当$\frac{T_1}{T_p}=\Theta(P)$时，称为线性加速，线性系数为1时即为完美线性加速
		- 松弛度：$\frac{T_1}{T_\infty P}$，松弛度递增时，算法趋近于完美线性加速算法，因此，设计算法时需要尽可能减小$T_\infty$
	- 并行算法的调度：
	- 调度器应当知晓目前计算机中所有的资源的使用情况，并给出合适的调度方案
	- 贪心调度：调度器总是使每一时刻时有尽可能多的资源处于工作状态
		- 可以证明，在贪心调度下，有：$T_p\leq \frac{T_1}{P}+T_\infty$
		- 推论：贪心调度时，实际运行时间$T_p$总是小于最优运行时间$T_p^*$的2倍
		- 当核数有限时，$P\ll \frac{T_1}{T_\infty}$，有$T_p\approx \frac{T_1}{P}$
- 并行斐波那契数列算法：
	- 串行递归算法：![[Pasted image 20250603083124.png]]复杂度$\Theta(\phi^n)$
	- 并行算法：![[Pasted image 20250603083233.png]]
		- 可以推导出并行度：$\frac{T_1(n)}{T_\infty(n)}=\Theta(\frac{\phi^n}{n})$，是一个好的并行算法
		- 图模型：分别标记派生、计算与返回的节点，构成一个有向无环图，为Pert图![[Pasted image 20250603083820.png]]在图上运行关键路径算法，即可得到程序运行的时间（在可以无限并行的理想情况下）
- 并行循环：
	- 矩阵与向量的并行乘法：![[Pasted image 20250603090658.png]]
	- 串行时间：$\Theta(n^2)$
	- 并行时间：
		- 算法用分治的方式进行并行循环的分割，花费时间$\Theta(\lg n)$
		- 最后层并行执行，复杂度$\Theta(n)$
		- 总时间为：$\Theta(n+\lg n)=\Theta( n)$
	- 并行度：$\frac{\Theta(n^2)}{\Theta(n)}=\Theta(n)$
- 并行时的竞争错误：
	- 当并行地对同一个变量发生读写操作时，可能会对同一个位置发生读写从而导致算法的错误
	- 例：![[Pasted image 20250603091543.png]]
# 并行矩阵乘法
- 并行循环算法：![[Pasted image 20250603092130.png]]
	- $T_1(n)=\Theta(n^3)$
	- $T_\infty(n)=\Theta(n+\lg n+\lg n)=\Theta(n)$
	- 并行度为$\Theta(n^2)$
- 分治并行算法：![[Pasted image 20250603092430.png]]![[Pasted image 20250603092501.png]]
	- $M_1(n)=8M_1(\frac{n}{2})+\Theta(n^2)=\Theta(n^3)$
	- $M_\infty(n)=M_\infty(\frac{n}{2})+\Theta(\lg n)=\Theta(\lg ^2n)$
	- 并行度为$\Theta(\frac{n^3}{\lg^2n})$
# 并行归并排序
- 并行分治：![[Pasted image 20250603092750.png]]
	- $T_1(n)=\Theta(n\lg n)$
	- $T_\infty(n)=T_\infty(\frac{n}{2})+\Theta(n)=\Theta(n)$
	- 并行度为$\Theta(\lg n)$，不是好的并行
- 优化：并行归并
	- 示意：![[Pasted image 20250603093110.png]]
	- 实现：![[Pasted image 20250603093123.png]]
	- 由此，可以并行的执行归并：![[Pasted image 20250603093140.png]]![[Pasted image 20250603093152.png]]![[Pasted image 20250603093158.png]]
		- $T_1(n)=$
		- \
	- 归并的并行度：
		- $T_1(n)=\Theta(n\lg n)$
		- $T_\infty(n)=T_\infty(\frac{n}{2})+\Theta(\lg^2 n)=\Theta(\lg^3 n)$
		- 并行度为$\Theta(\frac{n}{\lg^2 n})$