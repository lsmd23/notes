# 动态表
- 问题：实际问题中对连续的内存空间构成的表（向量、哈希表等），往往不希望过大的进行静态的内存分配（可能引起空间的浪费），但也不希望内存分配过小（引起溢出）
	- 解决：STL中`vector`类的动态内存调整是一种解决方式（在线的进行内存的控制）
- 向量的复杂度分析：
	- 插入的实现：![[Pasted image 20250415081425.png]]由于存在内存搬移的过程，一次操作的复杂度为$\Theta(n)$
	- 对连续的$n$次调用，总复杂度：
		- 记c_i为第i次插入花费的时间：$$c_i=\begin{cases}i &\text{if } i-1=2^m,m=0,1,2,\cdots\\1&\text{otherwise}\\\end{cases}$$
		- 总时间花费：$$\text{total cost}=\sum_{i=1}^nc_i\leq n+\sum_{j=0}^{\lfloor\lg n\rfloor}2^j<3n=\Theta(n)$$
		- 故平均单次插入的复杂度为$\Theta(1)$
- 类似上述的分析方法即为均摊分析法：对算法，分析一系列操作的平均花费，而不是简单的将单次操作花费的时间求和
	- 分析最坏情况下单次效率的平均时间
	- 方法：聚集法、核算法、势能法
# 聚集法
- 思路：计算代码运行$n$次后，各个操作花费时间的总和，在均摊到$n$次内即可
- 递增二进制计数器：
	- 实现：从低位到高位遍历![[Pasted image 20250415082946.png]]单次复杂度$\Theta(k)$
	- 总复杂度：
		- 对第$i$位$(i<\lfloor\lg n\rfloor)$，其一共会转变$\lfloor\frac{n}{2^i}\rfloor$次
		- 总复杂度：$$\sum_{i=0}^{\lfloor\lg n\rfloor}\lfloor\frac{n}{2^i}\rfloor<n\sum_{i=0}^{\infty}\frac{1}{2^i}=2n$$
		- 故总复杂度为$O(n)$，均摊复杂度为$O(1)$
# 核算法
- 思路：
	- 取一个每次操作的平均估计值$\hat{c_i}$
	- 对每次操作，花销时间比估计值小，则将少开销的时间存入一个“银行”中；反之则从银行中取出
	- 条件：$\sum_{i=1}^n\hat{c_i}\geq\sum_{i=1}^nc_i$
- 向量插入：
	- 对每次插入操作分配3的花费，插入花费1，搬移花费1
	- 例：![[Pasted image 20250415085701.png]]![[Pasted image 20250415085709.png]]
	- ![[Pasted image 20250415085750.png]]
- 二进制计数器：
	- 对每次递增操作分配2的花费，对每个位置的操作花费1
	- 可以得到，每次计数器中有多少个1，银行中就剩余了多少的开销
	- 进而，计数器的运转不会使得银行内的花销低于0
# 势能分析
- 思路：
	- 将前述的存在银行内的开销记为这一数据结构的势能
	- 定义数据结构的初态为$D_0$，第$i$个操作将状态从$D_{i-1}$转移到$D_i$，实际花销为$c_i$
	- 定义势能函数$\Phi:\{D_i\}\rightarrow R$，使得$\Phi(D_0)=0$，且$\forall i,\Phi(D_i)\geq 0$；定义估计值$\hat{c_i}=c_i+\Phi(D_i)-\Phi(D_{i-1})$
		- 对两个状态间的势能差$\Delta\Phi=\Phi(D_i)-\Phi(D_{i-1})$，若$\Delta\Phi>0$，则$\hat{c_i}>c_i$，对应在银行中存入开销；若$\Delta\Phi<0$，则$\hat{c_i}<c_i$，对应在银行中取出开销
	- 正确性：对任意时刻的$n$：$$\begin{align}\sum_{i=1}^n\hat{c_i}&=\sum_{i=1}^n(c_i+\Phi(D_i)-\Phi(D_{i-1}))\\&=\sum_{i=1}^nc_i+\Phi(D_n)-\Phi(D_{0})\\&\geq \sum_{i=1}^nc_i\\\end{align}$$
- 动态表：
	- 定义势能函数：$\Phi(D_i)=2\cdot num_i-size_i$
	- 当$i-1$不是$2$的指数幂时：$$\begin{align}\hat{c_i}&=c_i + \Phi(D_i) − \Phi(D_{i−1})\\&= 1 + (2 · num_i − size_i )− (2 · num_{i−1} − size_{i−1})\\&= 1 + (2 · num_i − size_i )− (2(num_i − 1) − size_i )\\&= 3\end{align}$$
	- 当$i-1$是$2$的指数幂时：$$\begin{align}\hat{c_i}&=c_i + \Phi(D_i) − \Phi(D_{i−1})\\&= 1 + (2 · num_i − size_i )− (2 · num_{i−1} − size_{i−1})\\&= 1 + (2 · num_i − 2(num_i-1) )− (2(num_i − 1) − (num_i-1) )\\&= 3\end{align}$$
	- 动态表的收缩：
		- 当填充因子$\alpha_i=\frac{num_i}{size_i}<\frac{1}{4}$时，进行内存的缩减
		- 扩充势能函数：$$\Phi(T)=\begin{cases}2\cdot num[T]-size[T]&\text{if }\alpha(T)\geq \frac{1}{2}\\ \frac{size[T]}{2}-num[T]&\text{if }\alpha(T)< \frac{1}{2}\\\end{cases}$$
		- 对插入操作：
			- 当填充因子$\alpha_i<\frac{1}{2}$时：$$\begin{align}\hat{c_i}=&c_i+\Phi_i-\Phi_{i-1}\\&=1+(\frac{size_i}{2}-num_i)-(\frac{size_{i-1}}{2}-num_{i-1})\\&=1+(\frac{size_i}{2}-num_i)-(\frac{size_{i}}{2}-(num_{i}-1))\\&=0\\\end{align}$$
			- 当填充因子$\alpha_i\geq\frac{1}{2},\alpha_{i-1}<\frac{1}{2}$时：$$\begin{align}\hat{c_i}=&c_i+\Phi_i-\Phi_{i-1}\\&=1+(2\cdot num_i-size_i)-(\frac{size_{i-1}}{2}-num_{i-1})\\&=1+(2( num_{i-1}+1)-size_{i-1})-(\frac{size_{i-1}}{2}-num_{i-1})\\&=3\cdot num_{i-1}-\frac{3}{2}size_{i-1}+3\\&=3\alpha_{i-1} size_{i-1} - \frac{3}{2} size_{i-1} + 3\\&< \frac{3}{2} {size}_{i-1} - \frac{3}{2} {size}_{i-1} + 3\\&=3\\\end{align}$$
		- 对删除操作：
			- 当填充因子$\alpha_{i-1}<\frac{1}{2},\alpha_i\geq \frac{1}{4}$时：$$\begin{align}\hat{c}_i &= c_i + \Phi_i - \Phi_{i-1}\\&= 1 + \left(\frac{\text{size}_i}{2} - \text{num}_i\right) - \left(\frac{\text{size}_{i-1}}{2} - \text{num}_{i-1}\right)\\&= 1 + \left(\frac{\text{size}_i}{2} - \text{num}_i\right) - \left(\frac{\text{size}_i}{2} - (\text{num}_i + 1)\right)\\&=2\\\end{align}$$
			- 当填充因子$\alpha_{i-1}<\frac{1}{2},\alpha_i< \frac{1}{4}$时，有$\frac{\text{size}_i}{2}=\frac{\text{size}_{i-1}}{4}=\text{num}_{i-1}=\text{num}_{i}+1$：$$\begin{align}\hat{c}_i &= c_i + \Phi_i - \Phi_{i-1}\\&= (num_i + 1) + \left(\frac{\text{size}_i}{2} - num_i\right) - \left(\frac{\text{size}_{i-1}}{2} - num_{i-1}\right)\\&= (num_i + 1) + \left((num_i + 1) - num_i\right) - \left((2 \cdot num_i + 2) - (num_i + 1)\right)\\&=1\\\end{align}$$
- 二进制计数器：
	- 势能函数：$\Phi_i$定义为在第$i$次操作后，得到的数中1的数目
		- 势能差：$\Phi(D_i) - \Phi(D_{i-1}) \leq (b_{i-1} - t_i + 1) - b_{i-1}= 1 - t_i$其中$t_i$表示第$i$次操作后被重置为0的位的数目
	- 摊还分析：$$\begin{align}\hat{c}_i &= c_i + \Phi(D_i) - \Phi(D_{i-1})\\&\leq (t_i + 1) + (1 - t_i)\\&=2\end{align}$$
---
