# 应用层协议原理
- 网络应用：在网页上编写的应用，需要借助网络实现通信、传输等
- 网络应用的架构：
	- **客户端-服务器（C/S）架构**：
		- 客户端：也即各个用户的边缘设备，它们需要向服务器发送请求，并接收服务器的响应以完成任务
		- 服务器：一台位于中心的，始终开启的计算机，负责处理客户端的请求，并返回相应的数据
	- **端到端（P2P）架构**：
		- 每个节点既是客户端又是服务器，节点之间可以直接通信
		- 节点之间是间歇性连接的，不需要始终在线
- 进程间通信：
	- 同一主机内，由操作系统定义进程间通信的方式
	- 不同主机间，由应用层协议定义进程间通信的方式
		- 客户端进程：向服务器进程发送请求
		- 服务器进程：接收客户端请求，并返回响应
	- **套接字**（Socket）：应用层与传输层之间的接口，类似于“门”的作用
	- **进程寻址**：
		- 每台主机有一个唯一的IP地址，长度为32位（IPv4）或128位（IPv6）
		- 每个进程有一个唯一的端口号，长度为16位
		- 寻址方式：**IP地址+端口号**
- 应用层协议：
	- 定义了通信双方的一些固定格式，包括：
		- 类型：请求、响应等
		- 语法：数据格式、编码方式等
		- 语义：控制信息、错误处理等
		- 时序：数据传输的顺序、速率等
	- 常见的应用层协议：HTTP、FTP、SMTP、POP3、IMAP、DNS、P2P等
- 互联网传输协议：也即信息传输过程中的协议，会在[[S3 运输层|传输层]]中更详细的介绍
	- **TCP**（传输控制协议）：面向连接，可靠传输，具有流量控制、拥塞控制等功能，适用于对数据传输要求较高的应用
	- **UDP**（用户数据报协议）：无连接，不可靠传输，适用于对数据传输要求不高，但对实时性要求较高的应用
	- 例：电子邮件、文件传输等使用TCP协议，视频会议、在线游戏等使用UDP协议
# Web和HTTP协议
- **网页**（Web page）：由HTML、CSS、JavaScript等组成的文档，可以通过浏览器进行访问和展示
	- 网页由**对象**组成，对象可以是HTML文本、图片、视频、小程序等
	- 网页的基础是由HTML（超文本标记语言）编写的，其中可以引用其他对象（如CSS、JavaScript、图片等）
	- **浏览器**（Browser）：用于访问和展示网页的应用程序，也即Web应用中的**客户端**
	- **Web服务器**（Web server）：用于存储和管理网页的计算机，也即Web应用中的**服务器**
	- 网页的**URL**：一个路径，用于标识网页中的对象，格式为`http://主机名:端口号/路径`
		- 例：`http://www.example.com:80/index.html`
- ==**HTTP协议**==：超文本传输协议（HyperText Transfer Protocol）
	- 用于浏览器和Web服务器之间的通信的协议，属于**应用层协议**
	- 基于传输层的**TCP协议**实现，默认端口号为**80**
	- HTTP连接：
		- 非持续连接：每次请求和响应都需要建立和关闭一次TCP连接，多个请求需要多次建立和关闭连接
		- 持续连接：在一次TCP连接中，可以发送多个HTTP请求和响应
		- **响应时间**：从客户端发送请求到接收响应的时间，包含传输延迟、处理时间等
			- 对一次连接，每次响应时间为两倍的RTT（往返时间）和传输时间之和，$T_{\text{response}} = 2 * RTT + T_\text{trans}$
			- 两倍时间是因为需要发送请求和接收响应各一次
	- **HTTP消息**（Message）：也叫**报文**
		- **请求报文**：由请求行、请求头、空行、请求体组成![[Pasted image 20251015214102.png]]
			- **请求行**：包含方法（GET、POST等）、URL、HTTP版本
				- ==**请求方法**==：表示客户端希望服务器执行的操作
					- GET：请求获取资源
					- POST：提交数据给服务器
					- PUT：更新资源
					- ……
			- **请求头**：包含一些控制信息，如Host、User-Agent、Accept等
			- **请求体**：包含一些数据，如表单数据等（可选）
		- **响应报文**：由状态行、响应头、空行、响应体组成![[Pasted image 20251015214324.png]]
			- **状态行**：包含HTTP版本、状态码（200、404等）、状态描述
				- ==**状态码**==：表示服务器对请求的处理结果
					- 200 OK：请求成功
					- 301 Moved Permanently：资源已永久移动
					- 400 Bad Request：请求有误
					- 404 Not Found：资源未找到
					- 505 HTTP Version Not Supported：HTTP版本不支持
					- ……
			- **响应头**：包含一些控制信息，如Content-Type、Content-Length等
			- **响应体**：包含实际的数据，如HTML文档、图片等
- 用户状态记录——==cookie技术==：
	- HTTP是无状态协议，即每次请求都是独立的，服务器不会记录客户端的状态。为了标识用户，使得访问更加快捷，诞生了**Cookie技术**
	- 组成：
		1. 响应报文中的首部行
		2. 请求报文中的首部行
		3. 浏览器中的cookie文件，由用户端保留并管理
		4. 服务器端的数据库，由服务器端保留并管理
	- 工作方式：
		1. 用户第一次访问服务器时，服务器生成一个唯一标识符（Session ID），并将其存储在数据库中，同时通过响应报文的首部行将该标识符发送给浏览器
		2. 浏览器收到响应报文后，将标识符存储在cookie文件中
		3. 用户再次访问服务器时，浏览器会在请求报文的首部行中携带该标识符，服务器通过该标识符从数据库中查找用户的状态信息
		- 如图：![[Pasted image 20251015214834.png]]
	- 优点和问题：
		- 提高用户体验：用户无需重复登录或填写信息
		- 个性化服务：根据用户的偏好提供定制化内容
		- 隐私问题：可能被用于跟踪用户行为，存在隐私泄露风险
- Web缓存（Web Cache）与代理服务器（Proxy Server）：
	- 单中心的Web服务器可能无法满足大量用户的访问需求，导致响应时间变长
	- **Web缓存**：在客户端或中间节点存储常用的网页和资源，减少对原始服务器的请求，提高响应速度
	- **代理服务器**：位于客户端和服务器之间，代表客户端向服务器发送请求，并将响应返回给客户端，缓存常用的访问资源
		- 可以实现负载均衡、安全过滤、内容缓存等功能
		- 如图：![[Pasted image 20251015215428.png]]
- **条件GET方法**：
	- 为了减少不必要的数据传输，HTTP协议引入了条件GET方法
	- 工作方式：
		1. 客户端在第一次请求资源时，服务器会返回资源的最后修改时间（Last-Modified）或实体标签（ETag）
		2. 客户端在后续请求中，可以在请求头中携带If-Modified-Since或If-None-Match字段，表示只在资源被修改后才返回
		3. 服务器根据条件判断资源是否被修改，如果没有修改，则返回304 Not Modified状态码，客户端继续使用缓存的资源；如果修改了，则返回新的资源
		- 如图：![[Pasted image 20251015215529.png]]
# *文件传输协议(FTP)
- 用于在网络上传输文件的协议，属于应用层协议
- 基于传输层的TCP协议实现，默认端口号为**21**（**控制连接**）和**20**（**数据连接**）
- 工作流程：
	1. 客户端与服务器建立控制连接，进行身份验证和命令传输
	2. 客户端发送命令，如LIST、RETR、STOR等
	3. 服务器响应命令，并建立数据连接进行文件传输
	4. 传输完成后，关闭数据连接，继续使用控制连接进行其他操作
# 电子邮件
- 电子邮件（Email）：一种通过计算机网络发送和接收消息的方式，有三个重要的组件：
	- 用户代理（User Agent，UA）：用户使用的电子邮件客户端，如Outlook、Thunderbird等
	- 邮件服务器（Mail Server）：负责存储和转发电子邮件的服务器
	- 邮件传输协议，如SMTP、POP3、IMAP等
- **SMTP**（简单邮件传输协议）：
	- 用于发送电子邮件的协议，属于应用层协议
	- 基于传输层的TCP协议实现，默认端口号为**25**
	- 工作流程：
		1. 用户代理将邮件发送给邮件服务器
		2. 邮件服务器使用SMTP协议将邮件转发给目标邮件服务器
		3. 目标邮件服务器将邮件存储在用户的邮箱中
	* 特点：
		* 只负责发送邮件，不负责接收和存储
		* 使用持续连接，支持多次邮件发送
		* 需要使用七位ASCII编码，二进制文件需要进行编码转换（如Base64）
		* SMTP是一种推送协议，对应的，HTTP是一种拉取协议
# 域名系统(DNS)
- 域名（Domain Name）：用于标识互联网中的计算机或资源的名称，便于记忆和使用
	- 结构：由多个标签组成，标签之间用点（.）分隔，最右侧的标签为顶级域（如.com、.org、.cn等）
	- 例：`www.example.com`
	- 域名有一定的实际含义，而计算机网络访问时需要使用IP地址，因此需要将域名转换为IP地址
- 域名系统（DNS，Domain Name System）：
	- 用于将域名转换为IP地址的分布式数据库系统，属于应用层协议
	- 基于传输层的UDP协议实现，默认端口号为**53**
	- 组成：
		- DNS客户端：也即用户的边缘设备，负责发送DNS查询请求
		- DNS服务器：负责存储域名和IP地址的映射关系，并处理DNS查询请求
			- **根DNS服务器**：位于DNS层次结构的顶端，负责管理顶级域名服务器，全球共有13个根DNS服务器
			- **顶级域名服务器**：负责管理二级域名服务器，一般归属于某个国家或地区
			- **权威DNS服务器**：负责存储具体域名和IP地址的映射关系，一般归属于某个组织或公司
			- **本地DNS服务器**：也叫递归DNS服务器，通常由ISP提供，负责处理用户的DNS查询请求，并与其他DNS服务器进行通信以获取所需的IP地址
	- 工作流程：
		1. 用户在浏览器中输入域名，DNS客户端向**本地DNS服务器发送查询请求**
		2. 本地DNS服务器检查**缓存**，如果有对应的IP地址，则直接返回；否则，向**根DNS服务器发送查询请求**
		3. 根DNS服务器返回对应的顶级域名服务器地址，本地DNS服务器继续向**顶级域名服务器发送查询请求**
		4. 顶级域名服务器返回对应的权威DNS服务器地址，本地DNS服务器继续向**权威DNS服务器发送查询请求**
		5. 权威DNS服务器返回对应的IP地址，本地DNS服务器将该地址**缓存**，并**返回给DNS客户端**
		6. DNS客户端将IP地址**返回给浏览器**，浏览器使用该IP地址与Web服务器建立连接，获取网页内容
		- 示意图：![[Pasted image 20251016152303.png]]
	- DNS协议：查询和回复都具有相同的报文格式
		- 报文结构：![[Pasted image 20251016152527.png]]
# 端到端网络(P2P)
- 在C/S架构中，服务器是单点故障，如果服务器宕机或网络中断，客户端将无法访问资源。且服务器端需要处理大量的请求，可能导致性能瓶颈
- P2P模式：每个节点既是客户端又是服务器，节点之间可以**直接通信**，分布式存储和处理资源
	- 工作方式：对每次节点对网络的某种资源请求：
		1. 节点向网络广播请求，询问是否有其他节点拥有该资源
		2. 拥有该资源的节点响应请求，并与请求节点建立连接
		3. 请求节点从响应节点获取资源
	- 几种P2P的模式：
		- 集中式目录：有一个或多个节点负责维护资源目录，其他节点向目录节点查询资源位置
			- 特点：简单易实现，但目录节点依然是单点故障
		- Gnutella式：没有集中目录，节点通过广播请求和响应来发现资源
			- 如图：![[Pasted image 20251016154738.png]]
			- 特点：去中心化，但广播会带来大量的网络流量
		- KaZaA式：引入超级节点，超级节点负责维护资源目录，普通节点向超级节点查询资源位置
			- 如图：![[Pasted image 20251016154821.png]]
			- 特点：兼顾了去中心化和效率，但超级节点可能成为性能瓶颈
---
[[S3 运输层]]