# 二分图的最大匹配
- 匹配问题：
	- 例：![[Pasted image 20250506192734.png]]
	- 定义：令$M$是图$G$的**边子集**，若$M$中**任意两条边都没有共同顶点**，则称$M$为$G$的一个匹配，其中与$M$的边**相关联的节点称为饱和点**，否则称为**非饱和点**
		- 设$M$是$G= (V,E)$中的一个匹配，若在$M$中加入任意一条边所得集合都不是匹配，则称$M$为**极大匹配**；如果对$G$的任意匹配$M'$，都有$|M| ≥ |M'|$，则称$M$为一个最大匹配
		- 例：![[Pasted image 20250506193018.png]]
- 二分图的最大匹配：
	- 定义：
		- 给定了$G$的一个匹配$M$，$G$中属于$M$与不属于$M$的边交替出现的道路称为**交互道路**
		- 设$P$是$G$中关于匹配$M$的一条交互道路，如果$P$的两个端点是关于$M$的**非饱和点**，那么它就称为**可增广道路**
		- 性质：
			- 可增广道路$P$一定包含奇数条边，且其中不属于匹配$M$的边比$M$中的边多一条
			- 同时$M'=P ⊕M$仍然是一个匹配，它使$P$的两个端点变成了饱和点，此时$|M'| = |M| + 1$，即$M'$是比$M$更大的匹配
			- 若边$e = v_iv_j$中的两个点都是非饱和点，则$e$也为增广路
	- 定理：$M$为$G$的最大匹配，当且仅当$G$不含关于$M$的可增广路径
		- 证明：![[Pasted image 20250506193756.png]]![[Pasted image 20250506193803.png]]![[Pasted image 20250506193811.png]]
	- 算法：匈牙利算法，输入二分图$G=(X,Y,E)$
		- 对点的标记：0表示尚未搜索；1表示饱和点；2表示是无法扩大匹配的顶点
		1) 任给一初始匹配$M$，给饱和点“1”标记
		2) 判断X中各顶点是否都已有非零标记
			- 若是，结束。$M$为最大匹配
			- 否则，找一“0”标记点$x_0 \in X$
		3) 从$x_0$出发通过深搜或者广搜寻找一条可增广路径
			- 找到从$x_0$到$y_i$的可增广路$P$，令$M\leftarrow M\oplus P$，给$x_0,y_i$标记“1”，转2
			- 搜索完毕没找到，$x_0$无法扩大匹配，给$x_0$标记“2”，转2
		- 复杂度：$O(mn)$
		- 例：
			- ![[Pasted image 20250506194324.png]]![[Pasted image 20250506194330.png]]![[Pasted image 20250506194335.png]]
# 完美匹配
- 定义：设$G= <V_1, V_2, E>$为二分图，$|V_1|\leq |V_2|$，如果$|M| = |V_1|$，则称$M$为$V_1$到$V_2$的完全匹配；若$|V_1| = |V_2|$，则完全匹配为**完美匹配**。**完全匹配为G中最大匹配**
- 定理：(Hall定理)二分图$G= <V_1, V_2, E>$，$|V_1| \leq|V_2|$，$G$中存在从$V_1$到$V_2$的完全匹配，当且仅当$V_1$中任意$k$个顶点至少与$V_2$中的$k$个顶点相邻$(k = 1...|V_1|)$
	- 该条件称为相异性条件
	- 证明：
		- ![[Pasted image 20250506194812.png]]![[Pasted image 20250506194817.png]]
	- 推论：设二分图$G= <V_1, V_2, E>$，$V_1$中每个顶点至少关联$k(k\geq 1)$条边，而$V_2$中每个顶点至多关联$k$条边，则$G$中存在$V_1$到$V_2$的完全匹配。
		- 该条件称为$k(k\geq 1)$条件
		- 证明：
			- ![[Pasted image 20250506194940.png]]
		- 例：![[Pasted image 20250506195200.png]]
- 定理：（**最大匹配边数**）二分图$G = (X, Y, E)$中，$X$到$Y$的最大匹配边数是$|X| - δ(G)$，其中：$A$为$X$中任意个数节点的子集，$\delta(G)=\max_{A\subseteq X}\delta(A)$，$\delta(A)=|A|-|\Gamma(A)|,\delta(A)\geq0$
	- 例：![[Pasted image 20250506200644.png]]
- 最大匹配数：
	- 对二分图，可以用一个$|X|\times|Y|$的矩阵表示；求最大匹配数也即求矩阵中不在同行同列的非零元的最多个数
	- 覆盖：适当地选取$A$的某些行和列，使这些行和列能盖住$A$的全部非零元，这称之为$A$的覆盖
	- 最小覆盖：如果**选取最少的行与列就能覆盖$A$的全部非零元**，则称这样的覆盖为最小覆盖。
		- 在矩阵$A$的全部覆盖中，一定存在最小覆盖，其覆盖数为$s$，显然$s ≤ \min(|X|, |Y|)$
	- Konig定理：设$r$是二分图$G$的最大匹配数，$s$是其邻接矩阵的最小覆盖数，则有$r = s$
# *最佳匹配*
- 若二分图转化为带权二分图，求权最值的匹配
- 定义：如果一带权二分图的边权是非负实数，而且存在多个完全匹配，那么其中**权和最大或最小的匹配就叫最佳匹配**
- 最大权匹配算法：
	- 思路：对**赋权的完全二分图**，且$|X| = |Y|$，$G$中所有边的权都是非负的，则$G$中一定有一个完美匹配是最大权匹配
		- 对于任何一个赋权的简单二分图$G$，总可以把求$G$的最大权匹配转化为求一个赋权的完全二分图中最大权完美匹配
		- 方法：增加点使得$|X| = |Y|$，且令新增加的边的权为0
	- KM算法：利用二分图的匹配矩阵，采用贪心定界的方式寻找最小覆盖，逐次增广得到完美匹配和最佳匹配
		- 算法步骤：
			1. 在已知矩阵$C$的每一行选一最大值作为本行的界值$l(x_i)$，每列的界值$l(y_j) = 0$，构造矩阵$B = (b_{ij})_{n\times n}$，其中$b_{ij}= l(x_i) + l(y_j) -c_{ij}$
			2. 在$B$中对$0$元素进行最小覆盖，覆盖数为$r$
				1. 若$r = n$，转第四步
				2. 在未覆盖的元素中选最小非零元，设值为$\delta$。若$x_i$行，$y_j$列均已覆盖，则$b_{ij}\leftarrow b_{ij}+ \delta$；若$x_i$行，$y_j$列均未覆盖，则$b_{ij}\leftarrow b_{ij}- \delta$
			3. 修改界值：若$x_i$行未覆盖，令$l(x_i) \leftarrow l(x_i) -\delta$，若$y_j$列已覆盖，令$l(y_j) \leftarrow l(y_j) + \delta$。删除覆盖标记，转第二步
			4. $\sum(l(x_i) + l(y_j))$即为最大权，结束
			- 注：对矩阵$B$，令0元素集合为$E$，得到二分图 $G = (X, Y, E)$，调用最大匹配的匈牙利算法可以求出它的一个最大匹配，即为0元素的最小覆盖数
		- 例：
			- ![[Pasted image 20250513153820.png]]
			- ![[Pasted image 20250513153827.png]]
- 最小权匹配：
	- 确定一个对应的新$n$阶矩阵$Q = (q_{ij})$，其中$q_{ij}$是大于等于$\max c_{ij}$的常数$a$，令$C'= Q –C$，则$c_{ij}' + c_{ij}= a$，所以$C$的最小匹配对应于$C'$的最大匹配
	- 类似于最大数匹配算法的思路，但是每行的最小元为界值，满足$b_{ij}= c_{ij}-l(x_i) -l(y_j) ≥ 0$，然后不断最小地增加界值，直至存在$n$个不在同行同列值为0的$b_{ij}$出现
# 匹配问题举例
- 猎人打鸟：
	- 猎人要在$n\times n$的格子里打鸟，他可以在某一行中打一枪，这样此行中的所有鸟都被打掉，也可以在某一列中打，这样此列中的所有鸟都打掉。问至少打几枪，才能打光所有的鸟？
	- 建图：二分图的$X$部为每一行，$Y$部为每一列，如果$(i, j)$有一只鸟，那么连接$X$部的$i$与$Y$部的$j$
	- 该二分图的最大匹配数则是最少要打的枪数
- 棋盘与棋子：
	- 问题：有一个$N\times M(N, M ≤ 50)$的棋盘，棋盘的每一格是三种类型之一：空地、草地、墙。机器人只能放在空地上。在同一行或同一列的两个机器人，若它们之间没有墙，则它们可以互相攻击。问给定的棋盘，最多可以放置多少个机器人，使它们不能互相攻击![[Pasted image 20250513154418.png]]
	- 建模：
		- 着色问题：以空地为顶点，有冲突的空地间连边，问题转化为求图的着色问题——可以着同一种颜色的节点的最大个数
			- 这样建模出的问题是NP难的
		- 匹配问题：![[Pasted image 20250513154543.png]]![[Pasted image 20250513154547.png]]![[Pasted image 20250513154555.png]]
---
[[Chapter 7 网络流]]