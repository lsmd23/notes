# 网络流图
- 解决实际的流量问题
- 基本概念：
	- 定义：网络$N$是一个无自环的有向连通图，满足：
		- 只有一个入度为0的点$s$，称为**源点**
		- 只有一个出度为0的点$t$，称为**汇点**
		- 每条边$(i, j)$都有一个非负实数权$c_{ij}$，称为该边的**容量**
		- 如果结点$i$到$j$没有边，则$c_{ij}= 0$
		- 既非源，又非汇的顶点称为**中间点**，一般地$c_{ij}\neq c_{ji}$
	- 当源、汇不唯一时，可以增加一个超发点$s_0$，一个超收点$t_0$，增加若干边$(s_0, s_i)$和$(t_j, t_0)$，其中$s_i, t_j$分别是每个产地和销地，同时边$(s_0, s_i)$的容量是$s_i$的生产能力，$(t_j, t_0)$容量是$t_j$的销售能力，转化为单源单汇的网络图
	- 流：在网络$N$中，如果每条边$e_{ij}$都给定一个非负实数$f(e_{ij})$，满足$0 ≤ f(e_{ij}) ≤ c_{ij}, e_{ij}∈N$且$\sum_jf(e_{ij}) = \sum_kf(e_{ki}), i≠ s, t$，则称f为该网络的**流**，又称为**可行流**
		- 第一个条件称为**容量约束**：一条有向边的流量不能够超过这条有向边的容量
		- 第二个条件称为**守恒条件**：对于任何中间点$v$，物资输入$v$的流量等于输出$v$的流量
		- 可行流总是存在的，例如所有$f_{ij}= 0$(称为零流)
	- 在网络$N$的一个容许流分布$f$里，满足$f_{ij}= c_{ij}$的边称为**饱和边**，否则为**非饱和边**
	- 对收、发点$u_t, u_s$有$\sum_if_{si}= \sum_jf_{jt}= W$（即从$u_s$点发出的物资总量等于$u_t$点输入量），$W$为网络流的**总流量**
	- 如果一个容许流分布使得网络的流量$w_0$为最大，即$w_0= \max \sum_jf_{sj}$，就说$w_0$是网络的**最大流**
		- **最大流问题**：是一个规划问题
			- 定义：
		- 求同时满足以下条件的$\max w$即可：$\forall (i,j)\in V,\sum f_{ij}-\sum f_{ji}= w(i= s);\sum f_{ij}-\sum f_{ji}= -w(i= t);\sum f_{ij}-\sum f_{ji}= 0(i≠s, t);0 ≤ f_{ij}≤ C_{ij}$可以用规划的方式求解
- 最大流-最小割定理：
	- 割切：设$S$是网络流图$N = (V, E)$中的一个结点集，满足：$s ∈ S$，$t \in \bar S,\bar S =V-S$，则全部有向边$(i, j), i ∈ S, j∈ \bar S$的集合称为$N$的一个**割切**，记为$(S,\bar S)$。把割切的全部边集去掉后，由$s$到$t$无任何有向路。$(S,\bar S)$中的各边的容量之和称为该割切的**容量**，记为$C$：$$(S,\bar S)=\sum_{(i,j)\in(S,\bar S)}c_{ij}$$注意：计算时应是**正向边的容量之和**
		- 例：![[Pasted image 20250514182928.png]]
	- 定理：**网络的最大流量等于最小割切容量**，即$\max w ≤ \min C$
		- 证明：![[Pasted image 20250514200408.png]]![[Pasted image 20250514200416.png]]
		- 意义：网络的各通路中，由容量决定其通过能力，最小割决定了整个网络的最大通过能力，也即流量具有所谓的瓶颈效应
- 增流路径：
	- 如果网络的容许流并不是最大流，则一定存在从$s$到$t$的**增流路径**
		- 令$s,i_1,i_2,\cdots,i_k,t$是一条初级路径$P_{st}$
		- 对前向边：每条边都是从$i_j$到$i_{j+1}$，若每条边上都有$f_{ij}<c_{ij}$，则令$\delta=\min_{e_{ij}\in P{st}}(c_{ij}-f_{ij})$，令$P_{st}$每条边的流都增加$\delta$，可以得到一个流量更大的流分布
		- 对后向边，由守恒条件，后向边的源点需要提供足够多的”流“，才能使得前向边可以增流$\delta$
	- 定义：
		- （有向的）饱和边：对前向边，$f_{ij}=c_{ij}$；对后向边，$f_{ji}=0$，称该边为饱和边
		- 对一条路径上的所有边，若前向边和后向边都不饱和，则这条道路为可增流路径，令：$$\delta_{ij}=\begin{cases}c_{ij}-f_{ij}&当(i,j)为前向边\\f_{ij}&当(i,j)为后向边\\\end{cases}$$则$\delta=\min\{\delta_{ij}\}$
# Ford-Fulkerson最大流标号算法
- 思路：
	- 从一个可行流开始，寻求关于这个可行流的可增流路径，若存在，则可以经过调整，得到一个新的可行流，其流量比原来的可行流要大，重复这个过程，直到不存在关于该流的可增增流路径时就得到了最大流
	- 包含两个过程：
		- 标号过程：检查网络中是否存在关于$f$的增流路径，如果不存在，则由定理，此时的$f$是最大流分布，其流量为最大流；否则，在标号过程中最后能标到结点$t$，即存在$s$到$t$的增流路径，转增流过程
		- 增流过程：确定一条从$s$到$t$的增流路径并修正这条路上的流，得到新的容许流分布$f'$，再转标号过程
- Ford-Fulkerson算法：
	- 步骤：
		1. 令$f$是任意一个流（例如$f = 0$），给$s$一个永久标号$(-,\infty)$
		2. 标号过程：若$v_i$已标号，如果可找到一个未标号结点$v_j$，则继续执行标记结点$v_j$，否则无法再找到可增流路径，结束
			1) 若存在$(v_i, v_j) = a$且$f(a) < c(a)$，则$v_j$标号$(v_j^+,\delta_{v_j}),\delta_{v_j}=\min\{\delta_{v_i},c(a)-f(a)\}$
			2) 若存在边$(v_j, v_i) = a$且$f(a) > 0$，则给$v_j$标号$(v_j^-,\delta_{v_j}),\delta_{v_j}=\min\{\delta_{v_i},f(a)\}$
		3. 若$t$已被标号，则找到了一条增流路径，转Step4，否则迭代执行Step1和2
		4. 由点$t$开始，使用标号的第一个元素构造一条$f$增流路$p$，修改$f$得到新的流$f'$，以$f'$代替$f$，删除$s$外的所有点的$f$标号，返回Step1。此处，$$f'=\begin{cases}f(a)+\delta_t&若其是前向边\\f(a)-\delta_t&若其是后向边\\f(a)&其他\\\end{cases}$$
	- 例：
		- 任给流分布：![[Pasted image 20250514202245.png]]
		- 进行标号，寻找增流路径![[Pasted image 20250514202214.png]]
		- 修改流：![[Pasted image 20250514202309.png]]
		- 进行标号，再寻找增流路径：![[Pasted image 20250514202345.png]]
		- 得到最大流分布：![[Pasted image 20250514202354.png]]
	- 问题：
		- 在算法中，对结点的标号顺序是任意的，即可以任选一条$s$到$t$的增流路径，每次所选的增流路径并不一定是最好的，因此算法复杂性可能会依赖于任选的参数
		- 深度优先搜索可增流路径，导致算法复杂度不确定
		- 解决：尽可能不重复使用增流路径，尽可能选用短的增流路径
# Edmonds-Karp算法
- 对Ford-Fulkerson算法的一个改进，使其每次沿一条最短的增流路径增流
- 算法描述：
	1. 令$f$是任意一个流（例如$f = 0$），给$s$一个永久标号$(-,\infty)$
	2. 标号过程：按照**先标号先检查**的方式，选择标号最早但尚未检查的点$v_i$。若所有的点都被检查过，说明找不到增流路径，结束。否则，对$v_i$的所有未标号的邻点$v_j$，如果可以通过正向或反向标号给以标号，则依次标号$v_j$
		1) 若存在$(v_i, v_j) = a$且$f(a) < c(a)$，则$v_j$标号$(v_j^+,\delta_{v_j}),\delta_{v_j}=\min\{\delta_{v_i},c(a)-f(a)\}$
		2) 若存在边$(v_j, v_i) = a$且$f(a) > 0$，则给$v_j$标号$(v_j^-,\delta_{v_j}),\delta_{v_j}=\min\{\delta_{v_i},f(a)\}$
	3. 若$t$已被标号，则找到了一条增流路径，转Step4，否则迭代执行Step1和2
	4. 由点$t$开始，使用标号的第一个元素构造一条$f$增流路$p$，修改$f$得到新的流$f'$，以$f'$代替$f$，删除$s$外的所有点的$f$标号，返回Step1。此处，$$f'=\begin{cases}f(a)+\delta_t&若其是前向边\\f(a)-\delta_t&若其是后向边\\f(a)&其他\\\end{cases}$$
- 复杂度：
	- 如果每步增广路径都是最短的话，那么整个算法将会执行$O(nm)$步，广度优先搜索时最坏情况下需$O(m)$次
	- 使用广探法(先标号先检查），复杂度$O(nm^2)$。结合启发式进一步改进，可提高到$O(n^2m)$
	- 问题：当$n$很大时，算法的复杂度太高
- 最大流的应用：
	- 例：工作分配问题：![[Pasted image 20250520101545.png]]
	- 例：逃生路线问题：![[Pasted image 20250520101605.png]]将人建模为1的供应节点，边上节点建模为1的吸收节点，每条边和每个节点的容量都是1
	- 节点容量问题：对节点有容量限制的网络流问题，将所有有容量的点分成两个点，点$v$有容量$C_v$，将点$v$分成两个点$v'$和$v''$，令$C(v'v'') = C_v$
# *最小费用流*
- 背景：不仅要使网上的流达到最大，而且还要使运输流的费用最小
- 定义：已知网络$G = (V, E, C)$，每条边$v_iv_j ∈ E$除了已给容量$C_{ij}$外，还给出了单位流量的费用$a_{ij}(≥ 0)$。最小费用流问题即为：求一个总流量已知的可行流 $f =\{ f_{ij} \}$使得总费用$a(f) = \Sigma_{v_iv_j\in E}a_{ij}f_{ij}$最小。特别地，当要求$f$为最大流时，此问题即为最小费用最大流问题
- 算法：最短增流路径算法：