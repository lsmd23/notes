# 引言
- 代码优化：在目标代码中消除不必要指令，并将原有指令替换成相同功能但效率更高的指令的过程
	- 依赖**数据流分析技术**和收集程序运行时信息
	- 来源：源程序的冗余运算或高级程序语言的特性
	- 语义不变的优化：优化前后程序的语义保持不变，例如：
		- 公共子表达式消除
		- 复制传播
		- 死代码消除
		- 常量折叠
- 优化的类型：
	- 按照范围划分
		- 窥孔优化：在几条指令范围内进行的优化
		- 局部优化：在基本块范围内进行的优化
		- 全局优化：在整个控制流图范围内进行的优化
		- 过程间优化：在整个程序范围内进行的优化
	- 按照对象划分
		- 目标代码优化
		- 中间代码优化
		- 源代码优化
	- 按优化侧面划分
		- 指令调度
		- 寄存器分配
		- 存储层次优化
		- 循环优化
		- 控制流优化
		- 过程优化
		- ……
# 窥孔优化
- 工作方式：在目标程序上滑动一个固定大小的窗口，对窗口内的指令按照某种优化策略进行优化
	- 可以适用于目标代码和中间代码
	- 主要优化举例：
		- **删除冗余加载和保存**：
			- 优化前：
				```
				ST a, R0
				LD R0, a
				```
			- 优化后：
				```
				ST a, R0
				```
		- **合并已知量**：
			- 优化前：`r2 = 3 * 2`
			- 优化后：`r2 = 6`
		- **常量传播**：
			- 优化前：
				```
				r1 = 5
				r3 = r1 + r2
				```
			- 优化后：
				```
				r1 = 5
				r3 = 5 + r2
				```
				如果已知`r1`不活跃，则可以删除`r1 = 5`这一指令
		- **代数简化**：
			- 优化前：`r1 = r2 * 1`
			- 优化后：`r1 = r2`
		- **控制流简化**：
			- 优化前：
				```
				goto L1
				L1: goto L2
				```
			- 优化后：
				```
				goto L2
				L1: goto L2
				```
		- **死代码消除**：
			- 优化前：
				```
				debug = false
				if (debug) print...
				```
			- 优化后：
				```
				debug = false
				```
		- **强度削减**：
			- 优化前：`r1 = r2 * 8`
			- 优化后：`r1 = r2 << 3`
		- **使用目标机惯用指令**：
			- 优化前：`r1 = r2 + r2 + r2 + r2`
			- 优化后（假设目标机有`MULI`指令）：`r1 = MULI r2, 4`
# 基本块优化
- 参见[[L7 代码生成#基本块优化|基本块优化]]
# 全局优化