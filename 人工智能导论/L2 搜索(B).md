# 约束满足问题
- 一般的搜索问题：每个状态是“原子化”的，状态是独立的黑箱
- 约束满足问题是一类特殊的搜索问题，每个状态是可以被描述刻画的，问题的目标是找到一组解满足这样的条件，而不关注得到这个解的过程
- 形式化定义：三元组$P=(X,D,C)$
	- $X=\{X_1,X_2,...,X_n\}$：问题变量
	- $D=\{D_1,D_2,...,D_n\}$：每个问题变元对应的取值范围$D_i=\{v_1,v_2,...,v_k\}$
	- $C$：约束条件，要求变量之间满足某种关系
	- 问题的解：每个变量的一组赋值：$\{X_i=v_i,X_j=v_j,...\}$，满足约束条件$C$
	- 约束图：一般约束条件是各个变量之间的关系，因而可以将各个变量视为节点，将约束关系视为边，构成一个图
- 定义搜索问题：
	- 状态：各个变量的赋值，初始状态为均没有赋值的状态，中间状态为部分赋值的状态
	- 后继函数：对某个变量进行赋值
	- 目标状态：满足约束条件的一个状态
- 例：
	- 地图染色问题：相邻关系构成约束
	- 八皇后问题：互不攻击构成约束
	- 数独问题：九个格子内数字不重复构成约束
# 回溯搜索
- 对简单搜索的优化：
	1. 由于赋值满足交换性，故可以人为规定一个变量的赋值顺序
	2. 在搜索过程中即有可能不满足约束条件，因而需要在搜索过程中随时进行条件检查
- 回溯搜索：**DFS+变量排序+约束检查**![[Pasted image 20250303154018.png]]效率并不高，需要启发式搜索进行优化
## 启发式变量排序
- 变量赋值按照一定的顺序，可以降低搜索的复杂性，免去无意义的枚举
- 准则：
	- 选取时，**优先选取受限最大的变量**
	- 赋值时，**优先赋予使其他变量受限最小的值**
## 启发式推理
- 前向推理：
	- 利用一个$Filter$函数，对搜索过程中赋值后产生的其他的变量的情况进行推断，对目前的赋值进行前向的检查（推理）![[Pasted image 20250303155229.png]]
	- 本质：在赋值前进行一步前向搜索，假设赋值后，若有变量值域为空，则不需要进行这一步赋值，免去先复制再回溯的过程
- 强制弧相容算法：
	- 弧相容：对约束图中的一条弧，两者的赋值是有相互关系的，因而可以对单条弧作处理，使弧的两侧变量的取值被规约
		- 遍历取值，若有取值是另一侧没有与之适配的取值，则该取值是不可行的
		- 伪码：![[Pasted image 20250303155848.png]]
	- 约束传播：在约束图中，对某一条弧作弧相容规约后，引起的取值范围缩小会沿着整个约束图进行传播，使得每个节点的取值都发生变化，即为约束传播
		- 例：![[Pasted image 20250303204043.png]]
		- *伪码：*![[Pasted image 20250303204142.png]]对弧作广度优先搜索，使之发生传播
		- *复杂度分析：对n个变量，定义域取值范围为d，每个约束有c个元，复杂度上界为$O(c\cdot d\cdot d^2)$*
		- 缺点：约束传播本质依然是前向推理，并不能直接得到结果
## 结构化分治
- 对约束图的不同结构，可以根据约束图的结构，加速搜索的进行
- 树状结构约束图：
	- 树状图存在拓扑排序，按照拓扑排序重新组织图的结构
	- 从最后的节点开始，依次向前，做强制弧相容和约束传播，对每一条边做弧相容，减小变量的定义域
	- 例：![[Pasted image 20250303162200.png]]
# 局部搜索
- 局部搜索思想：不必考虑全部的状态图，只需要考虑一部分，牺牲一部分问题的最优性和完备性换取复杂度的提升
## 爬山法——贪心局部搜索
- 在任何一个状态，都按照试图最接近解的方向的路径进行局部搜索，以期最快达到问题的解![[Pasted image 20250303162811.png]]
- 例：n皇后问题求解
	- 随机化赋予初值，再进行调整
	- 最接近解的方向，即为冲突最小的格子
	- ![[Pasted image 20250303163118.png]]
- 代价：
	- 对复杂的问题模型，可能会有不同的情况，导致找不到最优解，只能找到局部最优解的结果![[Pasted image 20250303163418.png]]
	- 解决：
		- **重启搜索**，采用新的随机化初始值
		- **引入随机性**，让局部化的搜索方向加入随机性，使其有避开局部极值的陷阱的可能性
## 模拟退火法
- 模拟化学结晶时，先升温再降温得到不同晶体的过程
- 实现：
	- 引入“温度”系数，用于控制搜索过程的随机性的大小
	- 引入“能量”，用于表示到最优解的距离
	- 伪代码：![[Pasted image 20250303164020.png]]也即利用一个方程，表示可以发生“能量转移”的可能性
	- 例：![[Pasted image 20250303164236.png]]
## 局部树搜索
- 局部搜索时，仅考虑最优的一个解，在找不到解时，则重启搜索，前一次搜索的过程并没有被下一次搜索应用到
- 解决：
	- 每次不是仅考虑一个而是考虑k个最符合约束的状态，对状态图做搜索
	- 搜索的过程是建立一棵k阶树的过程，在整个树上信息都是共享的，不需要反复进行重启搜索
	- 复杂度上界：$O(n(kb)\log(kb)),\text{for b means branching factor}$
	- 随机化树搜索：以一定随机性，选取k个子树节点，而不是单纯的选取最优的k个节点
## ==遗传算法==
- 基于前述的随机贪心树搜索，局部化搜索和随机化搜索的思想，结合生物学理论提出的思想
- ![[Pasted image 20250303165416.png]]